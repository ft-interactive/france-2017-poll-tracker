{% import "macros.html" as macros %}

{% extends "layout.html" %}

{% block article_body %}

<div class="graphic">

  <div class="standfirst">
    {{copy.intro | md}}
  </div>

  <section class="candidates">
    <div class="candidates__list">
    {% set bettingOdds = (data.betting | first) %}
    {% for candidate in data.candidates %}
      <div class="candidate candidate--{{candidate.key}}">
        <div class="candidate__image candidate__image--{{candidate.key}}">
          {{ macros.imageServiceImg(
            original=candidate.images.normal,
            alt='Illustration of ' + candidate.name.first + ' ' + candidate.name.last,
            widths=[94, 130, 188, 260]
          ) }}
        </div>

        <div class="candidate__details">
          <h2 class="candidate__name">{{candidate.name.first}} {{candidate.name.last}}</h2>
          <h3 class="candidate__party-name">
            {{candidate.party}}<span class="candidate__polling-at">&emsp13;&middot;&emsp13;Polling at {{candidate.currentPollingAverage | round}}%</span>
            {# DISABLED FOR NOW
            <span class="candidate__betting-odds">Bookies odds {{ bettingOdds | get(candidate.key) }}</span>
            #}
          </h3>

          <p class="candidate__description">{{candidate.description}}</p>
        </div>
      </div>
    {% endfor %}
    </div>
    <div class="candidates__read-more">
      <a role="button" href="https://ig.ft.com/sites/france-election/candidates/">{{copy.candidateProfilesLinkText}}</a>
    </div>
  </section>

  <section class="polls">
    <div class="polls__warning-banner">
      <i class="polls__warning-icon"></i>
      {{ copy.pollingCaveat | md(true) }}
    </div>
    <h2>{{copy.round1Headline}}</h2>
    <p class="polls__chart-subhead">{{copy.round1ChartLabel}}</p>

    <figure class="polls__round-1">
      <div data-multi-time-series="{{charts.round1 | dump}}"></div>
    </figure>

   <small class="polls__chart-note">{{copy.round1ChartFootnote}}</small>

    {# DISABLED FOR NOW
    <section class="polls__bookies">
      <h2>Another way to look at the race</h2>
      <p>Next President Betting Odds</p>
      <table class="polls__data-table-bookies">
        <thead>
          <tr>
            {% for candidate in data.candidates %}
            <th class="color-{{candidate.key}}">
              {{candidate.name.first}} {{candidate.name.last}}
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <tr>
            {% for candidate in data.candidates %}
            <td class="color-{{candidate.key}}">
              {{ bettingOdds | get(candidate.key) }}
            </td>
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </section>
    #}

    <section class="polls__round-2">
      <div class="polls__round-2__intro">
        <h2>{{copy.round2Headline}}</h2>
        {{copy.round2Intro | md}}
      </div>

      <div class="polls__round-2__chart">
        <h3>
          <span class="color-lepen">Le Pen</span> vs <span class="color-macron">Macron</span>
        </h3>

        <figure>
          <div data-multi-time-series="{{charts.round2.scenario1 | dump}}"></div>
        </figure>
      </div>

      <div class="polls__round-2__chart">
        <h3>
          <span class="color-lepen">Le Pen</span> vs <span class="color-fillon">Fillon</span>
        </h3>
        <figure>
          <div data-multi-time-series="{{charts.round2.scenario2 | dump}}"></div>
        </figure>
      </div>
    </section>
  </section>

  <section
    class="underlying-data"
    data-o-component="o-expander"
    data-o-expander-expanded-toggle-text="Show fewer polls"
    data-o-expander-collapsed-toggle-text="Show more polls"
  >
    <h2>{{copy.tableHeadline}}</h2>
    <p class="underlying-data__intro">{{copy.tableIntro | md(true)}}</p>

    <div class="underlying-data__table-wrapper">
      <table class="underlying-data__table o-expander__content">
        <thead>
          <tr>
            <td>Date</td>
            <td>Pollster</td>
            {% for candidate in data.candidates %}
            <td>{{ candidate.name.last | noBreak }}</td>
            {% endfor %}
            <td>Sample*</td>
          </tr>
        </thead>
        <tbody>
          {% for poll in data.round1 | reverse %}
          <tr>
            <td class="underlying-data__date">{{ poll.start | strftime('%b %-d') }}&ndash;{{ poll.end | strftime('%-d') }}</td>
            <td>{{ poll.pollster }}</td>
            {% for candidate in data.candidates %}
            <td>{{ (poll.result[candidate.key] | round(1)) + '%' if poll.result[candidate.key] else 'N/A' }}</td>
            {% endfor %}
            <td>{{ poll.sample }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="underlying-data__footnote">
        {{ copy.sourceNote }}
      </div>

      <div class="underlying-data__toggle-button">
        <button class="o-expander__toggle">Show more polls</button>
      </div>
    </div>

    {# <p class="underlying-data__source">{{copy.sourceNote}}</p> #}
  </section>

  <section class="end-matter">
    <div class="methodology">
      {{ copy.methodology | md }}
    </div>

    <div class="credits">
      {{ copy.footerCredit }}
    </div>
  </section>

</div>
{% endblock %}
