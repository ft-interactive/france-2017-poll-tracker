{% import "macros.html" as macros %}

{% extends "layout.html" %}

{% block article_body %}

<div class="graphic">

  <div class="standfirst">
    <p>It is the most closely watched French election in years. After the successes of Brexit and Trump campaigns, the world’s eyes have turned on France, where Marine Le Pen, leader of the populist National Front, is set to win the first round of the presidential race on April 23, and enter the run-off against either Emmanuel Macron or Francois Fillon.</p>
  </div>

  <section class="candidates">
    <div class="candidates__list">
    {% set bettingOdds = (data.betting | first) %}
    {% set latestPoll = (data.round1 | sort(true, false, 'date') | first) %}
    {% set latestPollResult = latestPoll.result %}
    {% for candidate in data.candidates %}
      <div class="candidate candidate--{{candidate.key}}">
        <div class="candidate__image candidate__image--{{candidate.key}}">
          {{ macros.imageServiceImg(
            original=candidate.images.normal,
            alt='Illustration of ' + candidate.name.first + ' ' + candidate.name.last,
            widths=[94, 130, 188, 260]
          ) }}
        </div>

        <div class="candidate__details">
          <h2 class="candidate__name">{{candidate.name.first}} {{candidate.name.last}}</h2>
          <h3 class="candidate__party-name">
            {{candidate.party}}
            <span class="candidate__polling-at"> — Polling at {{latestPollResult[candidate.key] | default('N/A')}}%</span>
            {# DISABLED FOR NOW
            <span class="candidate__betting-odds">Bookies odds {{ bettingOdds | get(candidate.key) }}</span>
            #}
          </h3>

          <p class="candidate__description">{{candidate.description}}</p>
        </div>
      </div>
    {% endfor %}
    </div>
    <div class="candidates__read-more">
      <a role="button" href="https://ig.ft.com/sites/france-election/candidates/">
        Read full profiles of candidates
      </a>
    </div>
  </section>

  <section class="polls">
    <div class="polls__warning-banner">
      <i class="polls__warning-icon"></i>
      {% set caveat = data.options | first | get('caveat') %}
      <strong>{{ caveat.lede }}</strong> {{ caveat.text }}
    </div>
    <h2>Who is leading in national opinion polls?</h2>
    <p>First round voting intention</p>

    <figure class="polls__round-1">
      <div data-multi-time-series="{{charts.round1 | dump}}"></div>
    </figure>

    <p class="polls__chart-note"><small>The chart above displays the five leading presidential candidates. Three other candidates for whom the polls are available are Nicolas Dupont-Aignan, Nathalie Arthaud and Philippe Poutou. The three consistently poll at 3 per cent or below, which does not give them much hope for the run-off.</small></p>

    {# DISABLED FOR NOW
    <section class="polls__bookies">
      <h2>Another way to look at the race</h2>
      <p>Next President Betting Odds</p>
      <table class="polls__data-table-bookies">
        <thead>
          <tr>
            {% for candidate in data.candidates %}
            <th class="color-{{candidate.key}}">
              {{candidate.name.first}} {{candidate.name.last}}
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <tr>
            {% for candidate in data.candidates %}
            <td class="color-{{candidate.key}}">
              {{ bettingOdds | get(candidate.key) }}
            </td>
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </section>
    #}

    <section class="polls__round-2">
      <div class="polls__round-2__intro">
        <h2>The run-off</h2>
        <p>If, as is traditionally the case, not one candidate secures the necessary 50 per cent of popular vote in the first round, two contenders will stand in the run-off on May 7. There are two possible scenarios French pollsters are focusing on.</p>

      </div>

      <div class="polls__round-2__chart">
        <h3>
          <span class="color-lepen">Le Pen</span> vs <span class="color-macron">Macron</span>
        </h3>

        <figure>
          <div data-multi-time-series="{{charts.round2.scenario1 | dump}}"></div>
        </figure>
      </div>

      <div class="polls__round-2__chart">
        <h3>
          <span class="color-lepen">Le Pen</span> vs <span class="color-fillon">Fillon</span>
        </h3>
        <figure>
          <div data-multi-time-series="{{charts.round2.scenario2 | dump}}"></div>
        </figure>
      </div>
    </section>
  </section>

  <section data-o-component="o-expander">
    <h2>National opinion polls</h2>
    <p>Below is a full list of individual opinion polls for the first round of the French presidential election</p>

    <table class="polls__data-table o-expander__content">
      <thead>
        <tr>
          <td>Date</td>
          <td>Pollster</td>
          {% for candidate in data.candidates %}
          <td>{{ candidate.name.last }}</td>
          {% endfor %}
          <td>Sample*</td>
        </tr>
      </thead>
      <tbody>
        {% for poll in data.round1 %}
        <tr>
          <td class="polls__data-table__date">{{ poll.start | strftime('%b %-d') }}&ndash;{{ poll.end | strftime('%-d') }}</td>
          <td>{{ poll.pollster }}</td>
          {% for candidate in data.candidates %}
          <td>{{ (poll.result[candidate.key] | round(1)) + '%' if poll.result[candidate.key] else 'N/A' }}</td>
          {% endfor %}
          <td>{{ poll.sample }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="polls__data-table-footnote">
      {% set footnote = data.options | first | get('table footnote') %}
      {{ footnote }}
    </div>
    <div class="polls__toggle-button">
      <button class="o-expander__toggle">Show more polls</a>
    </div>

  </section>

  <section class="credits">
    <p class="credit__illustrator">
      {% set illustrator = data.options | first | get('illustrations') %}
      <span>Illustrations by {{ illustrator }}</span>
    </p>
  </section>

</div>
{% endblock %}
