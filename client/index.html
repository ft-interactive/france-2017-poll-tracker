{% import "macros.html" as macros %}

{% extends "layout.html" %}

{% block article_body %}

<div class="graphic">
  <p>It is the most closely watched French election in years. After the successes of Brexit and Trump campaigns, the world’s eyes have turned on France, where Marine Le Pen, leader of the populist National Front, is set to win the first round of the presidential race on April 23, and enter the run-off against either Emmanuel Macron or Francois Fillon.</p>

  <section class="candidates">
    <h2>The candidates</h2>

    <div class="candidates__list">
    {% set latestPoll = (data.round1 | sort(true, false, 'date') | first) %}
    {% set latestPollResult = latestPoll.result %}
    {% for candidate in data.candidates %}
      <div class="candidate candidate--{{candidate.key}}">
        <div class="candidate__image candidate__image--{{candidate.key}}">
          {{ macros.imageServiceImg(
            original=candidate.images.normal,
            alt='Illustration of ' + candidate.name.first + ' ' + candidate.name.last,
            widths=[94, 130, 188, 260]
          ) }}
        </div>

        <div class="candidate__details">
          <h2 class="candidate__name">{{candidate.name.first}} {{candidate.name.last}}</h2>
          <h3 class="candidate__party-name">
            {{candidate.party}}
            <span class="candidate__polling-at"> — Polling at {{latestPollResult[candidate.key] | default('N/A')}}%</span>
          </h3>

          <p class="candidate__description">{{candidate.description}}</p>
        </div>
      </div>
    {% endfor %}
    </div>
    <div class="candidates__read-more">
      <a role="button" href="https://ig.ft.com/sites/france-election/candidates/">
        Read full profiles of candidates
      </a>
    </div>
  </section>

  <section class="polls">
    <h2>Who is leading in national opinion polls?</h2>
    <p>First round voting intention</p>

    <figure class="polls__round-1">
      <div data-multi-time-series="{{charts.round1 | dump}}"></div>
    </figure>

    <p><small>The chart above displays the five leading presidential candidates. Three other candidates for whom the polls are available are Nicolas Dupont-Aignan, Nathalie Arthaud and Philippe Poutou. The three consistently poll at 3 per cent or below, which does not give them much hope for the run-off.</small></p>

    <h2>How to read the polls</h2>
    <p>It has been a rough couple of elections for political polling, which is why we recommend to view the above as a guide to rather than a prediction of how the votes will be distributed on the day of the election. At this point in time, still around 35 per cent of voters [dynamic bit fed from the spreadsheet? TBC with Alan] have not made up their minds who to vote for or whether to vote at all. The no-shows and first-time voters might be key to the final results.</p>

    <section class="polls__round-2">
      <div class="polls__round-2__intro">
        <h2>The run-off</h2>
        <p>If, as is traditionally the case, not one candidate secures the necessary 50 per cent of popular vote in the first round, two contenders will stand in the run-off on May 7. There are two possible scenarios French pollsters are focusing on.</p>

        <h3>Run-off scenarios</h3>
      </div>

      <div class="polls__round-2__chart">
        <h3>
          <span class="color-lepen">Le Pen</span> vs <span class="color-macron">Macron</span>
        </h3>

        <figure>
          <div data-multi-time-series="{{charts.round2.scenario1 | dump}}"></div>
        </figure>
      </div>

      <div class="polls__round-2__chart">
        <h3>
          <span class="color-lepen">Le Pen</span> vs <span class="color-fillon">Fillon</span>
        </h3>
        <figure>
          <div data-multi-time-series="{{charts.round2.scenario2 | dump}}"></div>
        </figure>
      </div>
    </section>
  </section>

  <div data-o-component="o-expander">
    <h2>The data</h2>

    <table class="polls__data-table o-expander__content">
      <thead>
        <tr>
          <td>Date</td>
          <td>Pollster</td>
          {% for candidate in data.candidates %}
          <td>{{ candidate.name.last }}</td>
          {% endfor %}
          <td>Sample*</td>
        </tr>
      </thead>
      <tbody>
        {% for poll in data.round1 %}
        <tr>
          <td class="polls__data-table__date">{{ poll.start | strftime('%b %-d') }}&ndash;{{ poll.end | strftime('%-d') }}</td>
          <td>{{ poll.pollster }}</td>
          {% for candidate in data.candidates %}
          <td>{{ (poll.result[candidate.key] | round(1)) + '%' if poll.result[candidate.key] else 'N/A' }}</td>
          {% endfor %}
          <td>{{ poll.sample }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <button class="o-expander__toggle">Show more polls</a>
  </div>

</div>
{% endblock %}
